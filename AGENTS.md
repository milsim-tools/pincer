# Agent Guidelines for milsim-tools/pincer

## Build Commands
- `just build` - Compile the pincer binary
- `just run` - Build and run the application locally  
- `just gen` - Generate protobuf Go code (includes clean)
- `just proto-lint` - Lint protobuf files
- `just proto-breaking` - Check for breaking changes against main branch
- `just fmt` - Format Go code
- `just lint` - Lint Go code (go vet)
- `just check` - Compile everything to verify builds
- `just test` - Run Go tests

## Testing
- Standard Go testing with `go test`
- Run tests with `just test`
- Protobuf validation via `just proto-lint`

## Code Style Guidelines

### Go Code
- Uses Go 1.24+
- Standard Go conventions and formatting
- Use `just fmt` for formatting
- Use `just lint` for static analysis
- Module: `github.com/milsim-tools/pincer`

### Project Architecture
- **CLI Application**: Uses urfave/cli/v2 for command-line interface
- **gRPC Services**: Core business logic in gRPC services
- **Database**: GORM with PostgreSQL driver
- **Middleware**: gRPC middleware for logging and other cross-cutting concerns
- **Modular Design**: Separate packages for users, units, members, etc.

### Protobuf
- Use `proto3` syntax
- Package naming: `milsimtools.{module}.v1` (e.g., `milsimtools.units.v1`)
- Message field naming: `snake_case` (e.g., `display_name`, `owner_id`)
- Enum values: `SCREAMING_SNAKE_CASE` (e.g., `INVALID_ARGUMENT`)
- Services: PascalCase with Service suffix (e.g., `UnitsService`)

### Generated Go Code
- Auto-generated by protoc-gen-go in `pkg/api/gen/`
- Do not edit generated files (marked with `DO NOT EDIT`)
- Follows standard Go naming conventions
- Imports use full module paths

### File Organization
- `api/milsimtools/` - Protocol Buffer definitions
- `pkg/api/gen/` - Generated Go code from protobuf
- `pkg/{module}/` - Business logic packages (users, units, members, etc.)
- `cmd/pincer/` - Main application entry point
- `internal/` - Internal packages (helpers, middleware, models, etc.)

### Key Dependencies
- **gRPC**: google.golang.org/grpc for service communication
- **GORM**: Database ORM with PostgreSQL
- **CLI**: urfave/cli/v2 for command-line interface
- **Validation**: buf.build/go/protovalidate for protobuf validation
- **Gateway**: grpc-ecosystem/grpc-gateway/v2 for HTTP gateway
- **Logging**: Standard library slog for structured logging

### Error Handling
- Use standard gRPC status codes
- Follow protobuf validation rules defined in buf.yaml
- Structured error responses with proper context

### Environment Configuration
- Use `.env` file for local development (copy from `.env.sample`)
- Environment variables prefixed with service-specific names
- Configuration managed through CLI flags and environment variables